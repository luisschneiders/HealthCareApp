@page "/employees"
@page "/employee/{employeeId:guid}"

@using HealthCareApp.Data
@using HealthCareApp.Settings.Theme
@using HealthCareApp.Components.Page
@using HealthCareApp.Components.Modal
@using HealthCareApp.Components.Toast

@inject EmployeeService employeeService
@inject ToastService toastService

<PageWrapper>
    <PageHeader>
        <PageTitle Title="Employees"
                   Theme="Theme.employee"></PageTitle>
        <PageMenu>
            <button type="button"
                    class="btn btn-light btn-rounded btn-icon"
                    title="Search">
                <i class="bi bi-search"></i>
            </button>
            <button type="button"
                    class="btn btn-info btn-rounded btn-icon"
                    title="Add new employee"
                    @onclick="() => OpenModalAddEmployeeAsync()">
                <i class="bi bi-plus-lg"></i>
            </button>
        </PageMenu>
    </PageHeader>
    <PageBody Styles="p-2">
        @if (_employee == null)
        {
            <div class="h-100 d-flex flex-column justify-content-evenly align-items-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        } else
        {
            <div class="list-group gap-2">
                <Virtualize Context="person"
                            ItemsProvider="@LoadEmployees"
                            @ref="VirtualizeContainer">
                    <ItemContent>
                        <a href="/employee/@person.Id"
                            class="list-group-item list-group-item-action d-flex gap-3 py-3">
                            <i class="bi bi-person md-icon"></i>
                            <div class="d-flex gap-2 w-100 justify-content-between">
                                <div>
                                    <h6 class="mb-0">
                                        @person.EmployeeFirstName @person.EmployeeLastName
                                    </h6>
                                    <div class="gap-2 w-100 opacity-75">
                                        <div>
                                            @person.EmployeeUsername
                                        </div>
                                        <div>
                                            email: @(@person.ContactDetails == null ? "No email details" : @person.ContactDetails.Email)
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </ItemContent>
                    <Placeholder>
                        <div>
                            <span>Loading...</span>
                        </div>
                    </Placeholder>
                </Virtualize>
            </div>
        }
        <Toast />
    </PageBody>
    <PageFooter></PageFooter>
</PageWrapper>
<EditForm Model="@_employee"
          OnValidSubmit="@HandleValidSubmitAsync"
          OnInvalidSubmit="@HandleInvalidSubmitAsync"
          autocomplete="off">
    <ObjectGraphDataAnnotationsValidator />
    <Modal @ref="ModalAddEmployee"
           Theme="Theme.employee"
           Size="ModalSize.lg">
        <Title>Add new employee</Title>
        <Body>
            <div class="row">
                <div class="col-sm-8">
                    <div class="row mb-3">
                        <label class="col-sm-4 col-form-label"
                               for="EmployeeFirstName">
                            First Name
                        </label>
                        <div class="col-sm-8">
                            <InputText class="form-control"
                                       id="EmployeeFirstName"
                                       @bind-Value="@_employee.EmployeeFirstName" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-4 col-form-label"
                               for="EmployeeLastName">
                            Last Name
                        </label>
                        <div class="col-sm-8">
                            <InputText class="form-control"
                                       id="EmployeeLastName"
                                       @bind-Value="@_employee.EmployeeLastName" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-4 col-form-label"
                               for="EmployeeUsername">
                            Username
                        </label>
                        <div class="col-sm-8">
                            <InputText class="form-control"
                                       id="EmployeeUsername"
                                       @bind-Value="@_employee.EmployeeUsername" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label class="col-sm-4 col-form-label"
                               for="EmployeePassword">
                            Password
                        </label>
                        <div class="col-sm-8">
                            <InputText type="password"
                                       class="form-control"
                                       id="EmployeePassword"
                                       @bind-Value="@_employee.EmployeePassword" />
                        </div>
                    </div>

                    <fieldset>
                        <legend>Contact details</legend>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Email">
                                Email
                            </label>
                            <div class="col-sm-8">
                                <InputText type="email"
                                           class="form-control"
                                           id="Email"
                                           @bind-Value="@_employee.ContactDetails.Email" />
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Mobile">
                                Mobile
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="Mobile"
                                           @bind-Value="@_employee.ContactDetails.Mobile" />
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Phone">
                                Phone
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="Phone"
                                           @bind-Value="@_employee.ContactDetails.Phone" />
                            </div>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Address</legend>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Address">
                                Address
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="Address"
                                           @bind-Value="@_employee.Location.Address" />
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Suburb">
                                Suburb
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="Suburb"
                                           @bind-Value="@_employee.Location.Suburb" />
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="State">
                                State
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="State"
                                           @bind-Value="@_employee.Location.State" />
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label"
                                   for="Postcode">
                                Postcode
                            </label>
                            <div class="col-sm-8">
                                <InputText type="text"
                                           class="form-control"
                                           id="Postcode"
                                           @bind-Value="@_employee.Location.Postcode" />
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="col-sm-4">
                    @if (@DisplayValidationErrorMessages)
                    {
                        <div class="row mb-3">
                            <div class="col">
                                <label>Validation Messages: </label>
                                <ValidationSummary />
                            </div>
                        </div>
                    }
                </div>
            </div>
        </Body>
        <Footer>
            <button type="button"
                    class="btn btn-light btn-rounded"
                    data-dismiss="modal"
                    @onclick="() => CloseModalAddEmployeeAsync()">
                Cancel
            </button>
            <button type="submit"
                    class="btn btn-primary btn-rounded">
                Save
            </button>
        </Footer>
    </Modal>
</EditForm>
